# 타임리프 - 기본기능(2)

태그: 타임리프

## 속성 값 설정

- 타임리프 태그 속성
    - 타임리프는 주로 HTML 태그에 th:* 속성을 지정하는 방식으로 동작한다.
    - th:*로 속성을 적용하면 기존 속성을 대체한다
    - 기존 속성이 없으면 새로 만든다
- 속성 설정
    
    ```html
    - th:attrappend = <input type="text" class="text" th:attrappend="class=' large'" /><br/>
    - th:attrprepend = <input type="text" class="text" th:attrprepend="class='large '" /><br/>
    - th:classappend = <input type="text" class="text" th:classappend="large" /><br/>
    ```
    
    - th:attrappend : 속성 값의 뒤에 값을 추가한다
    - th:attrprepend : 속성 값의 앞에 값을 추가한다
    - th:classappend : class 속성에 자연스럽게 추가한다
- checked 처리
    - HTML에서는 checked 속성의 값과 상관없이 checked라는 속성만 있어도 체크가 된다
    - 타임리프의 th:checked는 값이 false인 경우 checked 속성 자체를 제거한다

## 반복

- 타임리프에서 반복은 th:each를 사용한다.
- 추가로 반복에서 사용할 수 있는 여러 상태 값을 지원한다
- 반복 기능
    - <tr th:each=”user : ${users}”>
    - 반복시 오른쪽 컬렉션의 값을 하나씩 꺼내서 왼쪽 변수에 담아 태그를 반복 실행한다
    - th:each는 java.util.Iterable, java.util.Enumeration을 구현한 모든 객체를 반복에 사용할 수 있다
    - Map도 사용할 수 있는데 이 경우 변수에 담기는 값은 Map.Entry이다
- 반복 상태 유지
    - <tr th:each=”user, userStat : ${users}”>
    - 반복의 두번째 파라미터를 설정해서 반복 상태를 확인할 수 있다
    - 두번째 파라미터는 생략 가능한데, 생략하면 지정한 변수명 + Stat이 된다

## 조건부 평가

- 타임리프의 조건식
- if, unless
    - 타임리프는 해당 조건이 맞지 않으면 태그 자체를 렌더링하지 않는다
    - <span th:text=”’미성년자’” th:if=”${user.age lt 20}”></span>
    - 조건이 false인 경우 아예 렌더링되지 않고 사라진다

## 주석

- 표준 HTML 주석
    - 자바스크립트의 표준 HTML 주석은 타임리프가 렌더링 하지 않고, 그대로 남겨둔다
- 타임리프 파서 주석
    - 타임리프 파서 주석은 타임리프의 진짜 주석이다.
    - 렌더링에서 주석 부분을 제거한다
- 타임리프 프로토타입 주석
    - HTML 파일을 웹 브라우저에서 열어보면 HTML 주석이기 때문에 이 부분을 웹 브라우저가 렌더링하지 않는다.
    - 타임리프 렌더링을 거치면 이 부분이 정상 렌더링된다
    - HTML 파일을 그대로 열어보면 주석처리가 되지만, 타임리프를 렌더링 한 경우에만 보인다

## 블록

- <th:block>은 HTML 태그가 아닌 타임리프의 유일한 자체 태그이다.

```html
<th:block th:each="user : ${users}">
      <div>
				사용자 이름1 <span th:text="${user.username}"></span>
				사용자 나이1 <span th:text="${user.age}"></span> </div>
			<div>
				요약 <span th:text="${user.username} + ' / ' + ${user.age}"></span>
      </div>
  </th:block>
```

- 타임리프의 특성상 HTML 태그안에 속성으로 기능을 정의해서 사용하는데, 사용하기 애매한 경우가 있다.
- 이럴 때 <th:block>을 사용한다
- <th:block>은 렌더링시 제거된다.

## 자바스크립트 인라인

- 자바스크립트에서 타임리프를 편리하게 사용할 수 있는 자바스크립트 인라인 기능이다.

```html
<!--인라인 사용 전-->
<script>
      var username = [[${user.username}]];
      var age = [[${user.age}]];
			//자바스크립트 내추럴 템플릿
			var username2 = /*[[${user.username}]]*/ "test username";
			//객체
      var user = [[${user}]];
</script>
<!--인라인 사용 후-->
<script th:inline="javascript">
      var username = [[${user.username}]];
      var age = [[${user.age}]];
			//자바스크립트 내추럴 템플릿
			var username2 = /*[[${user.username}]]*/ "test username";
			//객체
      var user = [[${user}]];
</script>
```

- 텍스트 렌더링
    - 인라인 사용 전 → var username = userA;
    - 인라인 사용 후 → var username = “userA”;
    - 인라인 사용 전의 경우 userA가 문자열이 아닌 변수명으로 사용되어서 자바스크립트 오류가 발생한다
    - 인라인 사용 후 렌더링 결과 문자 타입인 경우 “를 추가해준다.
    - 자바스크립트에서 문제가 될 수 있는 문자가 포함되어 있으면 이스케이프 처리를 해준다.
- 자바스크립트 내추럴 템플릿
    - var username2 = /*[[${user.username}]]*/ "test username";
    - 인라인 사용 전 → var username2 = /*username*/ “test username”
    - 인라인 사용 후 → var username2 = “userA”
    - 인라인 사용 전 결과는 렌더링 내용이 주석처리된다.
    - 인라인 사용 후 결과는 주석 부분이 제거되고, “userA”가 입력된다.
- 객체
    - 타임리프의 자바스크립트 인라인 기능을 사용하면 객체를 JSON으로 자동 변환해준다.
    - 인라인 사용 전 → var user = BasicController.User(username=userA, age=10);
    - 인라인 사용 후 → var user = {"username":"userA","age":10};
    - 인라인 사용 전은 toString()이 호출된 값
    - 인라인 사용 후는 객체를 JSON으로 변환해준다
- 자바스크립트 인라인 each
    
    ```html
    <script th:inline="javascript">     
          [# th:each="user, stat : ${users}"]
          var user[[${stat.count}]] = [[${user}]];
          [/]
    </script>
    ```
    
    - 결과
    
    ```html
    <script>
      var user1 = {"username":"userA","age":10};
      var user2 = {"username":"userB","age":20};
      var user3 = {"username":"userC","age":30};
    </script>
    ```
    

## 템플릿 조각

- 웹 페이지를 개발할 때 공통 영역을 개발하기 위해 타임리프는 템플릿 조각과 레이아웃 기능을 지원한다.
- footer
    
    ```html
    <!DOCTYPE html>
    <html xmlns:th="http://www.thymeleaf.org">
    <body>
    <footer th:fragment="copy"> 
    	푸터 자리 입니다.
    </footer>
    <footer th:fragment="copyParam (param1, param2)">
    	<p>파라미터 자리 입니다.</p>
    	<p th:text="${param1}"></p> 
    	<p th:text="${param2}"></p>
    </footer>
    </body>
    </html>
    ```
    
    - th:fragment가 있는 태그는 다른곳에 포함되는 코드 조각이다
- fragmentMain
    
    ```html
    <!DOCTYPE html>
    <html xmlns:th="http://www.thymeleaf.org">
    <head>
      <meta charset="UTF-8">
      <title>Title</title>
    </head>
    <body>
    <h1>부분 포함</h1>
    <h2>부분 포함 insert</h2>
    <div th:insert="~{template/fragment/footer :: copy}"></div>
    <h2>부분 포함 replace</h2>
    <div th:replace="~{template/fragment/footer :: copy}"></div>
    <h2>부분 포함 단순 표현식</h2>
    <div th:replace="template/fragment/footer :: copy"></div>
    <h1>파라미터 사용</h1>
    <div th:replace="~{template/fragment/footer :: copyParam ('데이터1', '데이터 2')}"></div>
    </body>
    </html>
    ```
    
    - template/fragment/footer :: copy : template/fragment/footer :: copy 템플릿에 있는 th:fragment=”copy”라는 부분을 템플릿 조각으로 가져와서 사용한다는 의미이다
    - th:insert : 현재 태그 내부에 추가한다
    - th:replace : 현재 태그를 대체한다
- 파라미터 사용
    - <div th:replace="~{template/fragment/footer :: copyParam ('데이터1', '데이터2')}"></
    div>
    - 다음과 같이 파라미터를 전달해서 동적으로 조각을 렌더링 할 수 있다

## 템플릿 레이아웃

- 코드 조각을 레이아웃에 넘겨서 사용하는 방법
- 예를 들어 <head>에 공통으로 사용하는 css, javascript 정보가 있는데, 이러한 공통 정보들을 한 곳에 모아두고 각 페이지마다 필요한 정보를 더 추가해서 사용하고 싶을 때 사용한다.
- base
    
    ```html
    <html xmlns:th="http://www.thymeleaf.org">
    <head th:fragment="common_header(title,links)"> 
    <title th:replace="${title}">레이아웃 타이틀</title>
    <!-- 공통 -->
          <link rel="stylesheet" type="text/css" media="all" th:href="@{/css/awesomeapp.css}">
          <link rel="shortcut icon" th:href="@{/images/favicon.ico}">
          <script type="text/javascript" th:src="@{/sh/scripts/codebase.js}">
    </script>
    <!-- 추가 -->
    <th:block th:replace="${links}" />
    </head>
    ```
    
- layoutMain
    
    ```html
    <!DOCTYPE html>
      <html xmlns:th="http://www.thymeleaf.org">
      <head th:replace="template/layout/base :: common_header(~{::title},~{::link})">
    <title>메인 타이틀</title>
    <link rel="stylesheet" th:href="@{/css/bootstrap.min.css}">
    <link rel="stylesheet" th:href="@{/themes/smoothness/jquery-ui.css}">
    </head> 
    <body> 
    메인 컨텐츠 
    </body> 
    </html>
    ```
    
    - common_header(~{::title},~{::link})
        - ::title은 현재 페이지의 title 태그들을 전달한다
        - ::link는 현재 페이지의 link 태그들을 전달한다